let { SlashCommandBuilder } = require('@discordjs/builders');

const mojangStatusFetcher = require("../fetcher/mojangStatusFetcher.js");
const emojisFetcher = require("../fetcher/emojisFetcher.js");

module.exports = {
  data: new SlashCommandBuilder()
    .setName('mojang')
  	.setDescription('Check status of mojang.')
    .addSubcommand(subcommand => subcommand.setName('status').setDescription("Check the mojang servers' status.")),
  
  async execute(client, MessageEmbed, embed, config, embedConfig, Permissions, interaction, messageEmojisReplacer, tick, cross, errorLogger, logger){
    embed = new MessageEmbed()
      .setColor(embedConfig.defaultColor);

    const emojis = await emojisFetcher(client);
    
    const branch = await emojis.branch;
    const branchEnd = await emojis.branchEnd;

    const mojangStatus = await mojangStatusFetcher();

    let skinsStatus;
    let websiteStatus;
    let apiStatus;
    let sessionStatus;
    let loginStatus;
    let realmsStatus;

    let skinsO;
    let websiteO;
    let apiO;
    let sessionO;
    let loginO;
    let realmsO;

    skinsO = websiteO = apiO = sessionO = loginO = realmsO = "ðŸ”´";

    if(mojangStatus.report.skins.status === "up"){
      skinsO = "ðŸŸ¢";
      skinsStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.skins.uptime}%\``;
    }else{
      skinsStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.skins.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.skins.down_since).getTime()/1000}:R>`;
    }

    if(mojangStatus.report.website.status === "up"){
      websiteO = "ðŸŸ¢";
      websiteStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.website.uptime}%\``;
    }else{
      websiteStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.website.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.website.down_since).getTime()}:R>`;
    }

    if(mojangStatus.report.api.status === "up"){
      apiO = "ðŸŸ¢";
      apiStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.api.uptime}%\``;
    }else{
      apiStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.api.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.api.down_since).getTime()}:R>`;
    }

    if(mojangStatus.report.session.status === "up"){
      sessionO = "ðŸŸ¢";
      sessionStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.session.uptime}%\``;
    }else{
      apiStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.session.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.session.down_since).getTime()}:R>`;
    }

    if(mojangStatus.report.login.status === "up"){
      loginO = "ðŸŸ¢";
      loginStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.login.uptime}%\``;
    }else{
      loginStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.login.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.login.down_since).getTime()}:R>`;
    }

    if(mojangStatus.report.realms.status === "up"){
      realmsO = "ðŸŸ¢";
      realmsStatus = `${branchEnd}â€¢ UPTIME- \`${mojangStatus.report.realms.uptime}%\``;
    }else{
      realmsStatus = `${branch}â€¢ UPTIME- \`${mojangStatus.report.realms.uptime}%\`
      ${branchEnd}â€¢ DOWN- <t:${new Date(mojangStatus.report.realms.down_since).getTime()}:R>`;
    }

    embed.setTitle("Mojang Status")
      .addFields({
        name: `${skinsO} SKINS`,
        value: skinsStatus
      },
      {
        name: `${websiteO} WEBSITE`,
        value: websiteStatus
      },
      {
        name: `${apiO} API`,
        value: apiStatus
      },
      {
        name: `${sessionO} SESSION`,
        value: sessionStatus
      },
      {
        name: `${loginO} LOGIN`,
        value: loginStatus
      },
      {
        name: `${realmsO} REALMS`,
        value: realmsStatus
      })
      .setThumbnail("https://i.ibb.co/71P14DF/mojang-logo.png");

    await interaction.editReply({embeds: [embed]}).catch(async error => {
      await errorLogger(client, interaction, error, "src/commands/mojang.js : 115");
    });
  },
}